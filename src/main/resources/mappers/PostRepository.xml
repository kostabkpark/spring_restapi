<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.spring_ex.repository.PostRepositoryInterface">
    <!--  ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ -->
    <select id="findAll"
            resultType="org.example.spring_ex.model.Post">
        SELECT postId, title, body, likes FROM post
    </select>

<!-- ============================================
version 1.0: ë‹¨ì¼ ì¡°ê±´ í•„í„° (titleë§Œ ì‚¬ìš©)
- ê°€ì¥ ë‹¨ìˆœí•œ ë™ì  SQL
- titleì´ nullì´ ì•„ë‹ˆë©´ title like ê²€ìƒ‰
- likesëŠ” ê³ ì • í•„í„°
 <select id="findAllDynamic"-->
<!--            resultType="org.example.spring_ex.model.Post"-->
<!--            parameterType="String">-->
<!--        SELECT * FROM post-->
<!--        WHERE likes >= 0-->
<!--        <if test="title != null">-->
<!--            AND title like concat('%', #{title}, '%')-->
<!--        </if>-->
<!--    </select>-->
    <!-- ============================================
  version 1.1: <choose> ì‚¬ìš© (ë‹¨ í•˜ë‚˜ì˜ ì¡°ê±´ë§Œ ì ìš©) / choose,when,otherwise
- title, likes ì¤‘ í•˜ë‚˜ë§Œ ì ìš©ë¨ (ì²« ë²ˆì§¸ë¡œ ë§Œì¡±í•˜ëŠ” ì¡°ê±´ë§Œ ì‹¤í–‰)
- ë‚˜ë¨¸ì§€ ì¡°ê±´ì€ ë¬´ì‹œë¨
- else ì—­í• ì˜ <otherwise>ë¡œ ê¸°ë³¸ í•„í„° ì¶”ê°€ ê°€ëŠ¥
   <select id="findAllDynamic"-->
<!--                resultType="org.example.spring_ex.model.Post"-->
<!--                parameterType="org.example.spring_ex.dto.PostRequiryDto">-->
<!--            SELECT * FROM post-->
<!--            WHERE postId >= 0-->
<!--                <choose>-->
<!--                    <when test="title != null">-->
<!--                        AND title like concat('%', #{title}, '%')-->
<!--                    </when>-->
<!--                    <when test="likes != 0">-->
<!--                        AND likes >= #{likes}-->
<!--                    </when>-->
<!--                    <otherwise>-->
<!--                        and body like "%test%"-->
<!--                    </otherwise>-->
<!--                </choose>-->
<!--        </select>-->
<!-- ============================================
version 1.2: <where> + <if> ì‚¬ìš©
- title, likes ì¡°ê±´ì„ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- <where>ëŠ” ì¡°ê±´ì´ ìˆìœ¼ë©´ WHERE ìë™ ì¶”ê°€ + ì²« AND ì œê±°
- ì¡°ê±´ì´ ëª¨ë‘ ì—†ìœ¼ë©´ WHERE ìì²´ ì œê±°ë¨

ğŸ’¡ ì•„ë˜ ì¡°ê±´ë³„ ê²°ê³¼ ì˜ˆì‹œ:
ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡
â‘  title="test", likes=0
â†’ SELECT * FROM post
WHERE title LIKE '%test%'

â‘¡ title="", likes=10
â†’ SELECT * FROM post
WHERE likes >= 10

â‘¢ title="test", likes=10
â†’ SELECT * FROM post
WHERE title LIKE '%test%' AND likes >= 10

â‘£ title="", likes=0
â†’ SELECT * FROM post
(ì¡°ê±´ ì—†ìŒ â†’ WHEREë„ ì—†ìŒ)
-->
    <select id="findAllDynamic"
            resultType="org.example.spring_ex.model.Post"
            parameterType="org.example.spring_ex.dto.PostRequiryDto">
        SELECT * FROM post
        <where>
            <if test="title != null and title != ''"><!-- ğŸ”¸ titleì´ nullì´ ì•„ë‹ˆê³  ë¹ˆ ë¬¸ìì—´ë„ ì•„ë‹ ê²½ìš°ì—ë§Œ í•„í„° ì ìš© -->
                title like concat('%', #{title}, '%')
            </if>
            <if test="likes != 0"><!-- ğŸ”¸ likesê°€ 0ì´ ì•„ë‹ˆë©´ í•„í„° ì ìš© -->
                AND likes >= #{likes}
            </if>
        </where>
    </select>

<!--    <select id="findByPostId"-->
<!--            resultType="org.example.spring_ex.model.Post"-->
<!--            parameterType="int">-->
<!--        select postId, title, body, likes FROM post-->
<!--        where postId = #{postId}-->
<!--    </select>-->
    <insert id="insertPost" parameterType="org.example.spring_ex.model.Post"
            useGeneratedKeys="true" keyProperty="postId">
        insert into post (title, body, likes)
        values (#{title}, #{body}, #{likes})
    </insert>
    <update id="updatePost" parameterType="org.example.spring_ex.model.Post">
        update post
        set likes = #{likes} , body = #{body}
        where postId = #{postId}
    </update>
    <delete id="deletePost"
            parameterType="int">
        delete from post
        where postId = #{postId}
    </delete>
</mapper>